<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Cuestionario de Videojuegos</title>
    <link rel="stylesheet" href="style_javascript_3.css">
    <!-- Incluir Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <!-- jsPDF y html2canvas -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>

</head>
<body>
    <h1>Cuestionario</h1>
    <h2>¿Qué tanto sabes sobre videojuegos?</h2>
    <section class="seccion">
        <form class="Formulario" id="cuestionarioForm">
            <!-- Sección de nombre -->
            <div class="question-section">
                <label for="nombre">Ingresa tu nombre:</label>
                <input type="text" name="nombre" id="nombre" placeholder="Ej: Juan Pérez" required>
            </div>
            
            <!-- Pregunta 1 -->
            <div class="question-section">
                <label>1. ¿Cuánto tiempo le dedicas a los videojuegos?</label>
                <div class="option-group">
                    <div class="option-item">
                        <input type="radio" name="tiempo" id="tiempo1" value="1" data-puntos="10">
                        <label for="tiempo1">Menos de 2 Horas Diarias</label>
                    </div>
                    <div class="option-item">
                        <input type="radio" name="tiempo" id="tiempo2" value="2" data-puntos="20">
                        <label for="tiempo2">Más de 2 Horas Diarias</label>
                    </div>
                    <div class="option-item">
                        <input type="radio" name="tiempo" id="tiempo3" value="3" data-puntos="30">
                        <label for="tiempo3">Más de 4 Horas Diarias</label>
                    </div>
                </div>
            </div>
            
            <!-- Pregunta 2 -->
            <div class="question-section">
                <label>2. ¿Cuáles géneros sueles jugar más?</label>
                <div class="option-group">
                    <div class="option-item">
                        <input type="checkbox" id="gen1" name="generos" value="Accion" data-puntos="5">
                        <label for="gen1">Acción</label>
                    </div>
                    <div class="option-item">
                        <input type="checkbox" id="gen2" name="generos" value="Aventura" data-puntos="5">
                        <label for="gen2">Aventura</label>
                    </div>
                    <div class="option-item">
                        <input type="checkbox" id="gen3" name="generos" value="Shooters" data-puntos="5">
                        <label for="gen3">Shooters</label>
                    </div>
                    <div class="option-item">
                        <input type="checkbox" id="gen4" name="generos" value="Competitivos" data-puntos="5">
                        <label for="gen4">Competitivos</label>
                    </div>
                    <div class="option-item">
                        <input type="checkbox" id="gen5" name="generos" value="MundoAbierto" data-puntos="5">
                        <label for="gen5">Mundo Abierto</label>
                    </div>
                    <div class="option-item">
                        <input type="checkbox" id="gen6" name="generos" value="Musicales" data-puntos="5">
                        <label for="gen6">Musicales</label>
                    </div>
                    <div class="option-item">
                        <input type="checkbox" id="gen7" name="generos" value="Online" data-puntos="5">
                        <label for="gen7">Online</label>
                    </div>
                    <div class="option-item">
                        <input type="checkbox" id="gen8" name="generos" value="Puzzles" data-puntos="5">
                        <label for="gen8">Puzzles</label>
                    </div>
                    <div class="option-item">
                        <input type="checkbox" id="gen9" name="generos" value="Indie" data-puntos="5">
                        <label for="gen9">Indie</label>
                    </div>
                    <div class="option-item">
                        <input type="checkbox" id="gen10" name="generos" value="Supervivencia" data-puntos="5">
                        <label for="gen10">Supervivencia</label>
                    </div>
                    <div class="option-item">
                        <input type="checkbox" id="gen11" name="generos" value="Anime" data-puntos="5">
                        <label for="gen11">Anime</label>
                    </div>
                    <div class="option-item">
                        <input type="checkbox" id="gen12" name="generos" value="RPGs" data-puntos="5">
                        <label for="gen12">RPGs</label>
                    </div>
                    <div class="option-item">
                        <input type="checkbox" id="gen13" name="generos" value="Estrategia" data-puntos="5">
                        <label for="gen13">Estrategia</label>
                    </div>
                    <div class="option-item">
                        <input type="checkbox" id="gen14" name="generos" value="Deportes" data-puntos="5">
                        <label for="gen14">Deportes</label>
                    </div>
                    <div class="option-item">
                        <input type="checkbox" id="gen15" name="generos" value="Ritmo" data-puntos="5">
                        <label for="gen15">Ritmo</label>
                    </div>
                </div>
            </div>
            
            <!-- Pregunta 3 -->
            <div class="question-section">
                <label>3. ¿En qué dispositivo sueles jugar videojuegos?</label>
                <div class="option-group">
                    <div class="option-item">
                        <input type="checkbox" id="dis1" name="dispositivos" value="Pc" data-puntos="10">
                        <label for="dis1">PC</label>
                    </div>
                    <div class="option-item">
                        <input type="checkbox" id="dis2" name="dispositivos" value="Xbox" data-puntos="10">
                        <label for="dis2">Xbox</label>
                    </div>
                    <div class="option-item">
                        <input type="checkbox" id="dis3" name="dispositivos" value="PlayStation" data-puntos="10">
                        <label for="dis3">PlayStation</label>
                    </div>
                    <div class="option-item">
                        <input type="checkbox" id="dis4" name="dispositivos" value="Nintendo" data-puntos="10">
                        <label for="dis4">Nintendo</label>
                    </div>
                    <div class="option-item">
                        <input type="checkbox" id="dis5" name="dispositivos" value="Movil" data-puntos="10">
                        <label for="dis5">Móvil</label>
                    </div>
                </div>
            </div>
            
            <!-- Pregunta 4 -->
            <div class="question-section">
                <label for="fav">4. ¿Cuál es tu videojuego favorito?</label>
                <input type="text" name="fav" id="fav" placeholder="Ej: The Legend of Zelda" required>
            </div>
            
            <!-- Pregunta 5 -->
            <div class="question-section">
                <label for="maxtiempo">5. ¿Cuál es el tiempo máximo que le has dedicado a un videojuego? (en horas)</label>
                <input type="number" name="maxtiempo" id="maxtiempo" placeholder="Ej: 150" min="0" required>
            </div>

            <button type="button" id="env" class="boton-calcular">Calcular Puntuación</button>
        </form>
    </section>

    <!-- Div para mostrar resultados -->
    <div id="resultado" class="seccion" style="display: none;">
        <h2>Resultados</h2>
        <p id="nombreResultado"></p>
        <p id="puntuacionTotal"></p>
        <p id="nivelGamer"></p>
        <div class="graficos-container" style="display: flex; flex-wrap: wrap; gap: 20px; margin-top: 30px;">
            <div style="flex: 1; min-width: 300px;">
                <h3>Distribución de Puntos</h3>
                <canvas id="graficoPuntos"></canvas>
            </div>
            <div style="flex: 1; min-width: 300px;">
                <h3>Géneros Preferidos</h3>
                <canvas id="graficoGeneros"></canvas>
            </div>
            <div style="flex: 1; min-width: 300px;">
                <h3>Dispositivos Usados</h3>
                <canvas id="graficoDispositivos"></canvas>
            </div>
        </div>
        <button id="descargarPDF" class="boton-calcular" style="margin-top: 20px;">Descargar PDF</button>

    </div>
    
    <script>
        document.getElementById('env').addEventListener('click', function() {
            // Obtener valores del formulario
            const nombre = document.getElementById('nombre').value;
            const juegoFavorito = document.getElementById('fav').value;
            const horasMaximas = document.getElementById('maxtiempo').value;
            
            // Calcular puntuación
            let puntuacion = 0;
            
            // Pregunta 1 (radio buttons)
            const tiempoSeleccionado = document.querySelector('input[name="tiempo"]:checked');
            if (tiempoSeleccionado) {
                puntuacion += parseInt(tiempoSeleccionado.getAttribute('data-puntos'));
            }
            
            // Pregunta 2 (checkboxes de géneros)
            const generosSeleccionados = document.querySelectorAll('input[name="generos"]:checked');
            const generosData = {};
            generosSeleccionados.forEach(genero => {
                const valor = genero.value;
                generosData[valor] = (generosData[valor] || 0) + parseInt(genero.getAttribute('data-puntos'));
                puntuacion += parseInt(genero.getAttribute('data-puntos'));
            });
            
            // Pregunta 3 (checkboxes de dispositivos)
            const dispositivosSeleccionados = document.querySelectorAll('input[name="dispositivos"]:checked');
            const dispositivosData = {};
            dispositivosSeleccionados.forEach(dispositivo => {
                const valor = dispositivo.value;
                dispositivosData[valor] = (dispositivosData[valor] || 0) + parseInt(dispositivo.getAttribute('data-puntos'));
                puntuacion += parseInt(dispositivo.getAttribute('data-puntos'));
            });
            
            // Pregunta 5 (horas máximas - puntos adicionales)
            let puntosHoras = 0;
            if (horasMaximas >= 100) {
                puntosHoras = 20;
            } else if (horasMaximas >= 50) {
                puntosHoras = 10;
            } else if (horasMaximas >= 20) {
                puntosHoras = 5;
            }
            puntuacion += puntosHoras;
            
            // Determinar nivel de gamer
            let nivel = "";
            if (puntuacion >= 70) {
                nivel = "¡Eres un Gamer Profesional! 🎮🔥";
            } else if (puntuacion >= 50) {
                nivel = "Gamer Avanzado 😎";
            } else if (puntuacion >= 30) {
                nivel = "Gamer Casual 👍";
            } else {
                nivel = "Aficionado - Sigue jugando! 😊";
            }
            
            // Mostrar resultados
            document.getElementById('nombreResultado').textContent = `Nombre: ${nombre}`;
            document.getElementById('puntuacionTotal').textContent = `Puntuación: ${puntuacion} puntos`;
            document.getElementById('nivelGamer').textContent = `Nivel: ${nivel}`;
            
            // Mostrar div de resultados
            document.getElementById('resultado').style.display = 'block';
            
            // Crear gráficos
            crearGraficos(puntuacion, puntosHoras, generosData, dispositivosData, tiempoSeleccionado);
            
            // Desplazarse a los resultados
            document.getElementById('resultado').scrollIntoView({ behavior: 'smooth' });
        });

        function crearGraficos(puntuacionTotal, puntosHoras, generosData, dispositivosData, tiempoSeleccionado) {
            // Destruir gráficos anteriores si existen
            if (window.graficoPuntos instanceof Chart) window.graficoPuntos.destroy();
            if (window.graficoGeneros instanceof Chart) window.graficoGeneros.destroy();
            if (window.graficoDispositivos instanceof Chart) window.graficoDispositivos.destroy();
            
            // Datos para el gráfico de puntos
            const ctxPuntos = document.getElementById('graficoPuntos').getContext('2d');
            window.graficoPuntos = new Chart(ctxPuntos, {
                type: 'doughnut',
                data: {
                    labels: ['Tiempo de Juego', 'Géneros', 'Dispositivos', 'Horas Máximas'],
                    datasets: [{
                        data: [
                            tiempoSeleccionado ? parseInt(tiempoSeleccionado.getAttribute('data-puntos')) : 0,
                            Object.values(generosData).reduce((a, b) => a + b, 0),
                            Object.values(dispositivosData).reduce((a, b) => a + b, 0),
                            puntosHoras
                        ],
                        backgroundColor: [
                            'rgba(255, 99, 132, 0.7)',
                            'rgba(54, 162, 235, 0.7)',
                            'rgba(255, 206, 86, 0.7)',
                            'rgba(75, 192, 192, 0.7)'
                        ],
                        borderColor: [
                            'rgba(255, 99, 132, 1)',
                            'rgba(54, 162, 235, 1)',
                            'rgba(255, 206, 86, 1)',
                            'rgba(75, 192, 192, 1)'
                        ],
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    plugins: {
                        legend: {
                            position: 'bottom',
                        },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    return `${context.label}: ${context.raw} puntos`;
                                }
                            }
                        }
                    }
                }
            });
            
            // Gráfico de géneros (barras horizontales)
            const ctxGeneros = document.getElementById('graficoGeneros').getContext('2d');
            window.graficoGeneros = new Chart(ctxGeneros, {
                type: 'bar',
                data: {
                    labels: Object.keys(generosData),
                    datasets: [{
                        label: 'Puntos por género',
                        data: Object.values(generosData),
                        backgroundColor: 'rgba(153, 102, 255, 0.7)',
                        borderColor: 'rgba(153, 102, 255, 1)',
                        borderWidth: 1
                    }]
                },
                options: {
                    indexAxis: 'y',
                    responsive: true,
                    plugins: {
                        legend: {
                            display: false
                        }
                    },
                    scales: {
                        x: {
                            beginAtZero: true,
                            title: {
                                display: true,
                                text: 'Puntos'
                            }
                        }
                    }
                }
            });
            
            // Gráfico de dispositivos (radar)
            const ctxDispositivos = document.getElementById('graficoDispositivos').getContext('2d');
            window.graficoDispositivos = new Chart(ctxDispositivos, {
                type: 'radar',
                data: {
                    labels: Object.keys(dispositivosData),
                    datasets: [{
                        label: 'Puntos por dispositivo',
                        data: Object.values(dispositivosData),
                        backgroundColor: 'rgba(255, 159, 64, 0.2)',
                        borderColor: 'rgba(255, 159, 64, 1)',
                        pointBackgroundColor: 'rgba(255, 159, 64, 1)',
                        pointBorderColor: '#fff',
                        pointHoverBackgroundColor: '#fff',
                        pointHoverBorderColor: 'rgba(255, 159, 64, 1)'
                    }]
                },
                options: {
                    responsive: true,
                    scales: {
                        r: {
                            angleLines: {
                                display: true
                            },
                            suggestedMin: 0,
                            suggestedMax: Math.max(...Object.values(dispositivosData)) + 10
                        }
                    }
                }
            });
            document.getElementById('descargarPDF').addEventListener('click', () => {
                const resultadoDiv = document.getElementById('resultado');

                html2canvas(resultadoDiv, {
                    scale: 2
                }).then(canvas => {
                    const imgData = canvas.toDataURL('image/png');
                    const { jsPDF } = window.jspdf;
                    const pdf = new jsPDF('p', 'mm', 'a4');
                    
                    // Calculamos el ancho y alto para mantener proporciones
                    const pageWidth = pdf.internal.pageSize.getWidth();
                    const pageHeight = pdf.internal.pageSize.getHeight();
                    const imgWidth = pageWidth - 20;
                    const imgHeight = canvas.height * imgWidth / canvas.width;

                    pdf.addImage(imgData, 'PNG', 10, 10, imgWidth, imgHeight);
                    pdf.save('resultados_gamer.pdf');
                });
            });

        }
    </script>
</body>
</html>